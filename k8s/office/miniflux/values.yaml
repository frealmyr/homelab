app:
  image:
    repository: miniflux/miniflux
    tag: latest

  secretEnvironmentVariables:
    - name: ADMIN_USERNAME
      secret:
        name: credentials-app-miniflux
        key: username
    - name: ADMIN_PASSWORD
      secret:
        name: credentials-app-miniflux
        key: password
    - name: DB_USERNAME
      secret:
        name: credentials-db-miniflux
        key: username
    - name: DB_PASSWORD
      secret:
        name: credentials-db-miniflux
        key: password
    - name: DB_HOST
      secret:
        name: credentials-db-miniflux
        key: endpoint
    - name: DB_PORT
      secret:
        name: credentials-db-miniflux
        key: port

  environmentVariables:
    RUN_MIGRATIONS: "1"
    CREATE_ADMIN: "1"
    DATABASE_URL: "postgres://$(DB_USERNAME):$(DB_PASSWORD)@$(DB_DATABASE):$(DB_PORT)/miniflux?sslmode=disable"

  containerPorts:
    - name: http
      containerPort: 8080
      protocol: TCP

  services:
    - name: http
      type: ClusterIP
      ports:
        - name: http
          port: 8080
          targetPort: 8080

  ingresses:
    enabled: true
    ingress:
      - name: frontend
        service:
          name: http
          port: 8080
        hosts:
          - host: news.fmlab.no
            paths:
              - path: /
                pathType: ImplementationSpecific
        tls:
          - secretName: miniflux
            hosts:
              - news.fmlab.no
