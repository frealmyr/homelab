app:
  image:
    repository: lycheeorg/lychee
    tag: latest

  environmentVariables:
    PUID: "1000"
    PGID: "1000"
    USER: "lychee"
    PHP_TZ: "Europe/Oslo"
    TIMEZONE: "Europe/Oslo"
    APP_NAME: "FMLab"
    APP_ENV: "production"
    APP_URL: "APP_URL"
    SECURITY_HEADER_HSTS_ENABLE: "false"
    LYCHEE_UPLOADS: "/uploads"
    APP_DEBUG: "false"
    LOG_CHANNEL: "warning"
    DB_CONNECTION: "mysql"
    DB_DATABASE: "lychee"
    CACHE_DRIVER: "redis"
    REDIS_HOST: "redis-redis.databases.svc.cluster.local"
    REDIS_PASSWORD: "null"
    REDIS_PORT: "6379"

  secretEnvironmentVariables:
    - name: DB_USERNAME
      secret:
        name: credentials-db-lychee
        key: username
    - name: DB_PASSWORD
      secret:
        name: credentials-db-lychee
        key: password
    - name: DB_HOST
      secret:
        name: credentials-db-lychee
        key: endpoint
    - name: DB_PORT
      secret:
        name: credentials-db-lychee
        key: port

  additionalContainers:
    - name: cloudflare-tunnel
      image:
        repository: milgradesec/cloudflared
        tag: latest
      command:
        - /usr/local/bin/cloudflared
        - '--no-autoupdate'
        - tunnel
        - run
      secretEnvironmentVariables:
        - name: TUNNEL_TOKEN
          secret:
            name: credentials-cloudflare-tunnel
            key: token

  containerPorts:
    - name: http
      containerPort: 80
      protocol: TCP

  services:
    - name: http
      type: ClusterIP
      ports:
        - name: http
          port: 80
          targetPort: 80
