app:
  image:
    repository: lycheeorg/lychee
    tag: latest

  environmentVariables:
    - PUID: "1000"
    - PGID: "1000"
    - USER: "lychee"
    - PHP_TZ: "Europe/Oslo"
    - TIMEZONE: "Europe/Oslo"
    - APP_NAME: "FMLab"
    - APP_ENV: "production"
    - APP_URL: "APP_URL"
    - SECURITY_HEADER_HSTS_ENABLE: "false"
    - LYCHEE_UPLOADS: "/uploads"
    - APP_DEBUG: "false"
    - LOG_CHANNEL: "warning"
    - DB_CONNECTION: "mysql"
    - DB_DATABASE: "lychee"
    - CACHE_DRIVER: "redis"
    - REDIS_HOST: "redis-redis.databases.svc.cluster.local"
    - REDIS_PASSWORD: "null"
    - REDIS_PORT: "6379"

  secretEnvironmentVariables:
    - DB_USERNAME
      secret:
        credentials-db-lychee
        key: username
    - DB_PASSWORD
      secret:
        credentials-db-lychee
        key: password
    - DB_HOST
      secret:
        credentials-db-lychee
        key: endpoint
    - DB_PORT
      secret:
        credentials-db-lychee
        key: port

  additionalContainers:
    - cloudflare-tunnel
      image:
        repository: milgradesec/cloudflared
        tag: latest
      command: 
        - /usr/local/bin/cloudflared
        - '--no-autoupdate'
        - tunnel
        - run
      secretEnvironmentVariables:
        - TUNNEL_TOKEN
          secret:
            credentials-cloudflare-tunnel
            key: token

  containerPorts:
    - http
      containerPort: 80
      protocol: TCP

  services:
    - http
      type: ClusterIP
      ports:
        - http
          port: 80
          targetPort: 80
