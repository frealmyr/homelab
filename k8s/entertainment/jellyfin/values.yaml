app:
  image:
    repository: lscr.io/linuxserver/jellyfin
    tag: latest

  environmentVariables:
    - name: PID
      value: "1000"
    - name: PGID
      value: "1000"
    - name: TZ
      value: "Europe/Oslo"
    - name: JELLYFIN_PublishedServerUrl
      value: "https://media.fmlab.no"
    - name: DOCKER_MODS
      value: "linuxserver/mods:jellyfin-amd"

  persistentVolumes:
    pvc:
      - name: config
        size: 10Gi
        mounts:
          - path: /config
            subPath: config
      - name: hdd1
        accessMode: ReadWriteMany
        storageClassName: nas
        volumeName: nfs-hdd1-entertainment
        size: 1Mi
        mounts:
          - path: /mnt/HDD1/Entertainment
      - name: hdd2
        accessMode: ReadWriteMany
        storageClassName: nas
        volumeName: nfs-hdd2-entertainment
        size: 1Mi
        mounts:
          - path: /mnt/HDD2/Entertainment

    hostPath:
      - name: devdri
        mountPath: /dev/dri
        hostPath: /dev/dri
        type: Directory

  podSecurityContext:
    supplementalGroups:
      - 44 # Video
      - 109 # Render

  resources:
    limits:
      smarter-devices/dri: "1"
    requests:
      smarter-devices/dri: "1"

  containerPorts:
    - name: http
      containerPort: 8096
      protocol: TCP

  services:
    - name: http
      type: ClusterIP
      ports:
        - name: http
          port: 8096
          targetPort: 8096

  liveness:
    enabled: false

  ingresses:
    enabled: true
    ingress:
      - name: frontend
        service:
          name: http
          port: 8096
        hosts:
          - host: media.fmlab.no
            paths:
              - path: /
                pathType: ImplementationSpecific
        tls:
          - secretName: jellyfin-frontend-tls
            hosts:
              - media.fmlab.no
