---
- hosts: all
  become: true

  tasks:
    # Kubernetes requires swap to be disabled
    # removing swap also speeds up reboots on rpi
    - name: swap - remove swapfile from /etc/fstab if it exist
      mount:
        name: "{{ item }}"
        fstype: swap
        state: absent
      with_items:
        - none
        - swap

    - name: swap - mask swap dphys service
      service:
        name: dphys-swapfile
        enabled: no
        masked: yes
        state: stopped

    - name: swap - disable swap
      command: swapoff -a
      when: ansible_swaptotal_mb > 0
