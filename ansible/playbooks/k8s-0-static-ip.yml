---
- hosts: all
  become: true
  max_fail_percentage: 0

  tasks:
    - name: netplan - remove default configuration
      ansible.builtin.file:
        path: /etc/netplan/00-installer-config.yaml
        state: absent

    - name: netplan - configure static ip
      blockinfile:
        path: /etc/netplan/00-server.yaml
        create: yes
        block: |
          network:
            version: 2
            renderer: networkd
            ethernets:
              enp3s0:
                dhcp4: false
                dhcp6: false
                addresses:
                    - 10.8.0.10/24:
                        label: enp3s0:private
                    - 10.8.0.11/24:
                        label: enp3s0:public
                nameservers:
                  addresses: [1.1.1.1,1.0.0.1]
                routes:
                    - to: default
                      via: 10.8.0.1
                      metric: 50
              enp4s0:
                dhcp4: false
                dhcp6: false
                addresses:
                    - 10.8.0.12/24
                nameservers:
                  addresses: [1.1.1.1,1.0.0.1]
                routes:
                    - to: default
                      via: 10.8.0.1
                      metric: 200
                      on-link: yes
