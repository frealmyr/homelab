- name: network - configure static ip
  copy:
    dest: /etc/systemd/network/20-ethernet.network
    content: "{{ content }}"
  vars:
    content: |
      [Match]
      Name=enp86s0

      [Network]
      DHCP=no
      DNS=1.0.0.1
      NTP=no.pool.ntp.org

      [Route]
      Gateway=192.168.0.1
      Metric=1024

      [Address]
      Address=192.168.0.20/16
      RouteMetric=50
  register: static_ip

- name: apt - remove packages
  apt:
    name: "{{ packages }}"
    state: absent
    autoremove: true
    purge: true
  vars:
    packages:
      - dhcpcd5
      - ifupdown
      - isc-dhcp-client
      - isc-dhcp-common
      - openresolv

- name: network - enable systemd services
  systemd:
    name: "systemd-networkd"
    enabled: yes
    masked: no
    state: started
  with_items:
    - systemd-networkd
    - systemd-resolved
    - systemd-timesyncd

- name: system - reboot (static ip set)
  reboot:
  when: static_ip.changed
