---
- hosts: k8s_master, k8s_workers
  become: true

  tasks:
    # Swapping to disk is bad business when we have the entire rootfs on NFS share.
    # Also, k8s requires swap to be disabled. So might as well start there.
    - name: swap - remove swapfile from /etc/fstab if it exist
      mount:
        name: "{{ item }}"
        fstype: swap
        state: absent
      with_items:
        - none
        - swap

    - name: swap - mask swap dphys service
      service:
        name: dphys-swapfile
        enabled: no
        masked: yes
        state: stopped

    - name: swap - disable swap
      command: swapoff -a
      when: ansible_swaptotal_mb > 0
